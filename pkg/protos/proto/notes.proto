syntax = "proto3";

package brz;

import "google/protobuf/empty.proto";
import "google/protobuf/struct.proto";
import "domain.proto";

option go_package = "github.com/autumnterror/breezynotes;brzrpc";

// ===== Requests =====
message ChangeBlockOrderRequest {
  string id = 1;
  int32 old_order = 2;
  int32 new_order = 3;
}
message ChangeTypeBlockRequest {
  string id = 1;
  string new_type = 2;
}
message OpBlockRequest {
  string id = 1;
  string op = 2;
  google.protobuf.Struct data = 3;
}

message ChangeTitleNoteRequest {
  string id = 1;
  string title = 2;
}



message TagToNoteRequest {
  string note_id = 1;
  string tag_id = 2;
}

message UpdateTagTitleRequest {
  string id = 1;
  string title = 2;
}
message UpdateTagColorRequest {
  string id = 1;
  string color = 2;
}
message UpdateTagEmojiRequest {
  string id = 1;
  string emoji = 2;
}

message UpdateNoteTitleRequest {
  string id = 1;
  string title = 2;
}

message ShareNoteRequest {
  string note_id = 1;
  string login_to_share = 2;
  Roles role = 3;
}

message ChangeUserRoleRequest {
  string login = 1;
  Roles new_role = 2;
}

message CreateBlockRequest {
  string type = 1;
  string noteId = 2;
  int32 pos = 3;
  google.protobuf.Struct data = 4;
}

message GetNotesByTagRequest {
  string idTag = 1;
  string idUser = 2;
}
message GetNotesByTagRequestPagination {
  string idTag = 1;
  string idUser = 2;
  int32 start = 3;
  int32 end = 4;
}
message GetNotesRequestPagination {
  string idUser = 1;
  int32 start = 2;
  int32 end = 3;
}

// ===== BlockNote Service =====
service BlockNoteService {
  rpc DeleteBlock(Id) returns (google.protobuf.Empty);
  rpc CreateBlock(CreateBlockRequest) returns (Id);
  rpc OpBlock(OpBlockRequest) returns (google.protobuf.Empty);
  rpc GetBlock(Id) returns (Block);
  rpc GetBlockAsFirst(Id) returns (StringResponse);
  rpc ChangeBlockOrder(ChangeBlockOrderRequest) returns (google.protobuf.Empty);
  rpc ChangeTypeBlock(ChangeTypeBlockRequest) returns (google.protobuf.Empty);

  rpc CleanTrash(UserId) returns (google.protobuf.Empty);
  rpc ChangeTitleNote(ChangeTitleNoteRequest) returns (google.protobuf.Empty);
  rpc NoteToTrash(Id) returns (google.protobuf.Empty);
  rpc NoteFromTrash(Id) returns (google.protobuf.Empty);
  rpc FindNoteInTrash(Id) returns (Note);

  rpc GetNote(Id) returns (Note);
  rpc CreateNote(Note) returns (google.protobuf.Empty);
  rpc UpdateNoteTitle(UpdateNoteTitleRequest) returns (google.protobuf.Empty);

  rpc GetAllBlocksInNote(Strings) returns (Blocks);
  rpc GetAllNotes(Id) returns (NoteParts);
  rpc GetNotesByTag(GetNotesByTagRequest) returns (NoteParts);
  rpc GetNotesFromTrash(Id) returns (NoteParts);

  rpc AddTagToNote(TagToNoteRequest) returns (google.protobuf.Empty);
  rpc RemoveTagFromNote(TagToNoteRequest) returns (google.protobuf.Empty);
  rpc CreateTag(Tag) returns (google.protobuf.Empty);
  rpc GetTagsByUser(Id) returns (Tags);
  rpc GetTag(Id) returns (Tag);
  rpc UpdateTagTitle(UpdateTagTitleRequest) returns (google.protobuf.Empty);
  rpc UpdateTagColor(UpdateTagColorRequest) returns (google.protobuf.Empty);
  rpc UpdateTagEmoji(UpdateTagEmojiRequest) returns (google.protobuf.Empty);
  rpc DeleteTag(Id) returns (google.protobuf.Empty);

  rpc ShareNote(ShareNoteRequest) returns (google.protobuf.Empty);
  rpc ChangeUserRole(ChangeUserRoleRequest) returns (google.protobuf.Empty);

  rpc Healthz(google.protobuf.Empty) returns (google.protobuf.Empty);
}
