## Welcome to BreezyNotes. The place where fantasy becomes reality!
#### Development by [Breezy Innovation RZN](https://about.breezynotes.ru) 
![BREEZYNOTES](https://i.ibb.co/PvRh0KvX/favicon.png)
### Technology stack:
![MongoDB](https://img.shields.io/badge/MongoDB-%234ea94b.svg?style=for-the-badge&logo=mongodb&logoColor=white)
![Postgres](https://img.shields.io/badge/postgres-%23316192.svg?style=for-the-badge&logo=postgresql&logoColor=white)
![Go](https://img.shields.io/badge/go-%2300ADD8.svg?style=for-the-badge&logo=go&logoColor=white)
### Frontend repository:
[GitHub](https://github.com/DaniilaRyadinsky/breezy)

# ДОКУМЕНТАЦИЯ

# Сервис аутентификации и работы с пользователями

Подключен к базе данных PostgreSQL

## Основные методы для аутентификации
Во всех методах при ошибке возвращается код и
{
"error": "текст ошибки"
}

В случае создания токенов методы возвращают их в заголовках Set-Cookie. Также для удобства они возвращают их напрямую в ответе

## В статусах положительным исходом всегда считается 200 (Ok). Если есть другие, то они будут указаны. Например 201 (create)

### Внимание, временно ошибки отправляются в виде `Error Trace` то есть вместо `"email and login is empty"` отправляется `op: grpc.Auth Error: ... : email and login is empty` тем самым необходимо валидировать их через частичное совпадение в строке


### /api/auth [post]
Используется для аутентификации пользователя. В случае нахождения его в базе данных возвращает access refresh токены. Также возвращает Set-Cookie заголовки с этими токена с нужным временем действия

#### Статусы
- 400 (bad request) возникает при неправильном вводе данных.
  - Неправильный json в body который нельзя считать "bad JSON"
  - Пустой email и login "email and login is empty"
  - Пустой пароль "pw is empty"
  - Неправильный пароль "password incorrect"
- 404 (not found) при отсутствии пользователя в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/auth/reg [post]
Используется для регистрации пользователя. В случае успеха возвращаются токены так же с Set-Cookie заголовками
#### Статусы
- 302 (found) пользователь уже существует
- 400 (bad request) возникает при неправильном вводе данных.
  - Неправильный json в body который нельзя считать "bad JSON"
  - Не совпадении паролей  "password not same"
  - Пустой email и login "email and login is empty"
  - Пустой пароль "pw is empty"
  - При несоответсвии пароля политике (более 5, менее 20 символов, минимум одна заглавная, один символ, одна цифра) "pw not in policy"
  - неправильный пароль "password incorrect"
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/auth/token [get]
Валидация токенов. Проверяет токены из cookie. В случае ошибки в access токене на основании refresh создает новый. Предпологается вызов при каждом действии при проверки сеанса авторизации

#### Статусы
- 201 при создании нового токена. Возвращает заголовок Set-Cookie
- 302 (found) пользователь уже существует
- 400 (bad request) возникает при неправильном вводе данных.
  - Пустой access и refresh (невозможен при текущей функциональности) "one of tokens is empty"
- 401 (unauthorized) при истечении сессии авторизации
  - При отсутсвии куки с рефреш токеном "refresh_token cookie missing"
  - Неправильный токен (refresh)
  - Refresh токен истек
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

---

## Далее все методы получают айди из access токена из куки файлов

---


## Основные методы для работы с пользователями
### /api/user/data [get]
Получение данных пользователя. Возвращается все, хеш пароля заменяется на ""

#### Статусы
- 401 (unauthenticated) возникает при неправильном токене
- 404 (not found) при отсутствии пользователя в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/user [delete]
Удаление пользователя

#### Статусы
- 400 (bad request) возникает при неправильном айди
- 401 (unauthenticated) возникает при неправильном токене
- 404 (not found) при отсутствии пользователя в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/user/about [patch]
Изменение поля "о себе"

#### Статусы
- 400 (bad request) возникает при 
  - неправильном json "bad JSON"
  - неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене
- 404 (not found) при отсутствии пользователя в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/user/email [patch]
Изменение поля "email"

#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - неправильном id "id not in uuid"
  - пустом email 
- 401 (unauthenticated) возникает при неправильном токене
- 404 (not found) при отсутствии пользователя в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/user/photo [patch]
Изменение поля "photo"
При пустом photo в запросе изменяется на "images/default.png"

#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене
- 404 (not found) при отсутствии пользователя в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/user/pw [patch]
Изменение пароля

#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - несовпадении паролей "password not same"
  - неподходящем под политику новым паролем "new password not in policy"
  - неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене 
- 404 (not found) при отсутствии пользователя в базе данных или несовпадения данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

---

# Сервис работы с заметками

Подключен к базе данных MongoDB. 

При каждом запросе используется id_user из access токена, который ожидается в cookie. В случае невозможности достать id возвращается 401 и  "bad idUser from access token". Все создания происходят именно для этого пользователя, чей айди в cookie. Также если идет взаимодействие с уже существующим обьектом, то по этому id производится авторизация.

## Основные методы для работы с тегами

### /api/tag [post] 
создание тега
#### Статусы
- 201 (created) успешное создание
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при пустых полях "login is empty" "email is empty" "photo is empty"
- 401 (unauthenticated) возникает при неправильном токене
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/tag/title [patch]
изменение поля название
#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при пустом поле "title is empty"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии тега в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/tag/color [patch]
изменение поля цвет
#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при пустом поле "color is empty"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии тега в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/tag/emoji [patch]
изменение поля эмоджи
#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при пустом поле "emoji is empty"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии тега в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/tag [delete]
удаление тега
#### Статусы
- 400 (bad request) возникает при
  - неправильном параметре id "bad param"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии тега в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/tag/by-user [get]
получение всех тегов пользователя
#### Статусы
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token")
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

## Основные методы для работы с корзиной

### /api/trash [delete]
очистка корзины
#### Статусы
- 401 (unauthenticated) возникает при неправильном токене
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.


### /api/trash/to [put]
Перемещение заметки в корзину
#### Статусы
- 400 (bad request) возникает при
  - неправильном параметре id "bad param"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии заметки в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/trash/from [put]
Перемещение заметки из корзины
#### Статусы
- 400 (bad request) возникает при
  - неправильном параметре id "bad param"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии заметки в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/trash [get]
получение списка заметок из корзины
#### Статусы
- 401 (unauthenticated) возникает при неправильном токене
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

## Основные методы для работы с заметками

### /api/note/title [patch]
изменение поля название
#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при пустом поле "title is empty"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии заметки в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/note [get]
получение заметки со списком блоков
#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при пустом id "bad param"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии заметки в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/note/all [get]
получение списка заметок
#### Статусы
- 400 (bad request) возникает при
  - неправильной пагинации  "bad start" "bad end" "start must be int" "end must be int" "start < 0!"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/note/by-tag [get]
получение списка заметок по тегу
#### Статусы
- 400 (bad request) возникает при
  - неправильной пагинации  "bad start" "bad end" "start must be int" "end must be int" "start < 0!"
  - при пустом id "bad param"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/note [post]
создание заметки
#### Статусы
- 201 (created) успешное создание
- 400 (bad request) возникает при
  - при пустом title "title is empty"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/note/tag [post]
добавление тега в заметку
#### Статусы
- 201 (created) успешное создание
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии заметки или тега в базе данных 
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/note/tag [delete]
ликвидация тега из заметки
#### Статусы
- 201 (created) успешное создание
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии заметки или тега в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/note/share [patch]
поделиться заметкой (добавление пользователя по логину в нужную роль в заметке) так же может изменить роль, если уже заметкая была расшерена
#### Статусы
- 201 (created) успешное создание
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при неправильном id "bad note id" "bad user id"
  - при пустой роли "role is empty"
  - при неизвестной роли "role undefined"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии пользователя или заметки в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.


## Основные методы для работы с блоками

### /api/block [get]
получение блока. Возможно не используемая. 
#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии блока или заметки в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/block [delete]
удаление блока

#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при неправильном id "id not in uuid"
  - при пустом id "no note id" "no block id"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии блока или заметки в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/block/order [patch]
изменение порядка блоков

#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - порядке < 0 "order < 0"
  - при неправильном id "id not in uuid"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии блока или заметки в базе данных
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/block [post]
создание блока

#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - неправильном data "bad data"
  - позиции < 0 "pos < 0"
  - при неправильном id "id not in uuid"
  - пустом типе "type is empty"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии блока или заметки в базе данных
- 424 (failed dependency) при использовании блока с незарегистрированным типом
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.


### /api/block/op [post]
операция над блоком

#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - неправильном data "bad data"
  - при неправильном id "id not in uuid"
  - пустом типе операции "op is empty"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии блока или заметки в базе данных
- 424 (failed dependency) при использовании блока с незарегистрированным типом
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

### /api/block/type [patch]
изменение типа блоков

#### Статусы
- 400 (bad request) возникает при
  - неправильном json "bad JSON"
  - при неправильном id "id not in uuid"
  - пустом новом типе "type is empty"
- 401 (unauthenticated) возникает при неправильном токене ("bad idUser from access token") или при отсутствии доступа к этому тегу у пользователя ("you dont have permission")
- 404 (not found) при отсутствии блока или заметки в базе данных
- 424 (failed dependency) при использовании блока с незарегистрированным типом
- 502 (bad gateway) при ошибке внутри сервиса. В этом случае ошибка логируется на микросервисе
- 504 (gateway timeout) при превышении времени ожидания запроса.

## Все 3 последних запроса работают с блоками относительно их типов. 